title: linux网络分享杂谈
date: 2015-06-09 01:45:09
tags:
- linux
- 网桥
- dhcp
---

今天摆弄了一下机器，想分享网络给一个树莓派，奈何路由器上的口用完了，又没有无线网卡，想通过接口对连的方式分享网络。
之前一直是用udhcp开启dhcp服务，客户端一插就能用了，今天想换一种方法，突然想到了网桥这东西。

so？摆弄了老半天，我滴天，原来网桥不是用来分享网络的，真是晕了，对不起我的专业啊！

上网查了一下，网桥是用来整合多个端口的东东，在虚拟化中常用（顺带说一下，我用virt-manager就不需要网桥，完全虚拟化网络），就相当于虚拟化了一个设备，是各个端口的上层设备，给交换机有点像，但是与单纯的交换机不同，交换机只是一个二层设备，对于接收到的报文，要么转发、要么丢弃。小型的交换机里面只需要一块交换芯片即可，并不需要CPU。而运行着linux内核的机器本身就是一台主机，有可能就是网络报文的目的地。其收到的报文除了转 发和丢弃，还可能被送到网络协议栈的上层（网络层），从而被自己消化。

网桥的功能：
-   MAC学习：学习MAC地址，起初，网桥是没有任何地址与端口的对应关系的，它发送数据，还是得想HUB一样，但是每发送一个数据，它都会关心数据包的来源MAC是从自己的哪个端口来的，由于学习，建立地址-端口的对照表（CAM表）。
-   报文转发：每发送一个数据包，网桥都会提取其目的MAC地址，从自己的地址-端口对照表(CAM表)中查找由哪个端口把数据包发送出去。


除了网桥，想要端对端连接两台linux设备就是开dhcp和直接设置ip了。

udhcp是我一直用的东西，主打轻量级，但是功能不怎么好用，例如不能开vlan，也不能同时服务连个接口，dnsmap好用很多，是Openwrt的默认dhcp服务软件。

设置静态ip，就是将两台机器的ip设置成同一个网段
例如
192.168.45.1
192.168.45.2
那样的话就能连接上了，但是这样的话网口的信号灯是不亮的，但是你不需要怀疑，直接ssh就能登上去

