title: 如何设计状态管理方案(一,思路篇)
date: 2020-05-12 17:26:54

---

我在另一篇文章中介绍了我们现在为什么要做状态管理[《为什么要做状态管理》
](https://www.chencanhao.com/Js/why-state-management)，这篇文章我们来聊聊该如何做好状态管理。

## 一，确定状态管理的必要性
如何设计状态管理最重要的是，你需要正确的认识到，自己即将要开发的前端系统是否需要全局，现代化的状态管理方案。

一般来说，如果你所开发的前端应用是一个服务端渲染应用，ajax 请求比较少，例如一个新闻网页，内容都是服务器渲染出来的，那么你不需要考虑状态管理，因为状态变化十分有限。

再或者，你所要开发的是一个偏营销的网站，你要设计很酷炫的动画，精妙的布局，来给消费者某种强烈的感官上冲击，那么你也大概不需要状态管理，同样的，这样的网站状态变化肯定不多，工作的重点是在视觉和交互上，如果在代码中使用了 redux 等方案，会显得十分奇怪，徒增复杂度。

当然，在复杂的页面上，例如，后台管理应用，商城类小程序或网页，聊天应用，大多数企业应用等等，这类系统有十分复杂且易变的状态，正确得使用状态管理方案会使代码架构更整洁，开发效率更高，代码更优雅。等等，或许你会说，我的应用很复杂，但是我没有使用状态管理，我使用了 service, 单例，hooks，graphql state，等等，嗯，事实上，这些种种方案，就是状态管理。

## 二，选择一个模式

近几年，前端的技术栈变化的非常块，迭代也很快。技术、框架、工具层出不穷。我见过一几个前端系统，由于开发迭代了很久，代码仓库集合了 redux，redux-observable，redux-saga，redux-axios-middle，graphql state，甚至开发者会说，redux 全局状态树不好，然后生成了子状态树，mobx 很火很不错，然后在某些页面上加入了 mobx。甚至有些开发成员在后端 DDD 思想中搬来了 repository，MVP 模式，在状态树前面继续包装。

oh，我的天，可千万不要这样做，且不论在一个代码上下文中同时使用那么多异构技术，**在一个代码上下文中，状态管理的方案只允许有一个**。

并且，项目开发人员应该清楚认识到，为什么这个项目的代码管理要这些用，这样写。

- 例如，redux 全局唯一状态树是为了保持变化只在一个地方发生，并维持简单，维持可预测性。
- graphql state 实际上就是在 graphql 内部做好了状态管理，你想要什么数据，BFF 或者内部的 state 已经帮你做好了，这样整个前端项目大部分只需要管好 UI 就行了。
- 而 MVP 事实上跟类 Flux 模式是互斥的，这两者使用了一个，就没必要用另者。

这些技术和方案，并不是说哪个比较好，哪个不好，redux好，flux不好之类的，这取决于你的情况。**我们所需要的，是确定好一个好的方案，选择一个模式，并写最好的代码，并在整个应用开发过程中，坚定不移的贯彻这种方案。** 千万不要写到一半，说这个地方用另一个更好，就轻易用了另一个方案，或者偷懒说这个地方直接请求数据渲染就好了啊，这是对架构和模式的破坏，应该杜绝这种行为，如果杜绝不了，那就换一个更好的方案，把之前的都重构掉。


## 分层

## 边界

## 构建良好的测试


